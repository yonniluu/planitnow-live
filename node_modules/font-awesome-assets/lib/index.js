'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.iconsByUnicodeHex = exports.icons = exports.aliases = undefined;
exports.svg = svg;
exports.img = img;
exports.png = png;
exports.png2x = png2x;
exports.png3x = png3x;

var _cheerio = require('cheerio');

var _cheerio2 = _interopRequireDefault(_cheerio);

var _svg2png = require('svg2png');

var _svg2png2 = _interopRequireDefault(_svg2png);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _svgfont2js = require('svgfont2js');

var _svgfont2js2 = _interopRequireDefault(_svgfont2js);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function applyAttributes($el, attrs) {
  // [ [ attr, val ], ... ]
  if (!_lodash2.default.isArray(attrs) || attrs.length === 0) return $el;
  var hasMissing = _lodash2.default.some(attrs, function (pair) {
    return !_lodash2.default.isArray(pair) || pair.length !== 2;
  });
  if (hasMissing) throw new Error('attribute pairs must be arrays with two keys [ attr, val ]');
  _lodash2.default.each(attrs, function (pair) {
    $el.attr(pair[0], pair[1]);
  });
  return $el;
}

// inspired by <https://github.com/riobard/font-awesome-svg/blob/master/extract.js>

function loadAliases(less) {

  var pairs = _lodash2.default.compact(_lodash2.default.map(less.split('\n'), function (line) {

    // line is `@fa-var-dropbox: "\f16b";`
    if (line.indexOf('@fa-var-') !== 0) return;

    // now it is `dropbox: "\f16b";`
    line = line.split('@fa-var-', 2)[1];

    // split the line by the `: ` delimiter
    line = line.split(': ');

    // now we have a line array that looks like:
    // [0] = `dropbox`
    // [1] = "\f16b";`

    // clean up the first key
    line[1] = line[1].split('"')[1].substring(1);

    return { name: line[0], unicode: line[1] };
  }));

  return _lodash2.default.zipObject(_lodash2.default.map(pairs, 'name'), _lodash2.default.map(pairs, 'unicode'));
}

var aliases = exports.aliases = loadAliases(_fs2.default.readFileSync(require.resolve('font-awesome/less/variables.less'), 'utf8'));

var icons = exports.icons = (0, _svgfont2js2.default)(_fs2.default.readFileSync(require.resolve('font-awesome/fonts/fontawesome-webfont.svg'), 'utf8'));

var iconsByUnicodeHex = exports.iconsByUnicodeHex = _lodash2.default.zipObject(_lodash2.default.map(icons, 'unicode_hex'), icons);

function svg(name, color, width, height, attrs) {

  // set defaults
  name = name || 'smile-o';
  color = color || '#000';
  width = (width || '100%').toString();
  height = (height || '100%').toString();

  // check variable types
  if (!_lodash2.default.isString(name)) throw new Error('fa.svg `name` must be a String');
  if (!_lodash2.default.isString(color)) throw new Error('fa.svg `color` must be a String');

  // convert name to lowercase
  name = name.toLowerCase();

  // remove "fa-" prefix from name if it exists
  if (name.indexOf('fa-') === 0) name = name.substring(3);

  // ensure that the font exists, otherwise throw an error
  if (!_lodash2.default.isString(aliases[name])) throw new Error('fa.svg name "' + name + '" must be a valid FontAwesome icon name');

  // get the icon svg information
  var icon = iconsByUnicodeHex[aliases[name]];

  // ensure that the font svg exists, otherwise throw an error
  if (!_lodash2.default.isObject(icon)) throw new Error('fa.svg name "' + name + '" was missing its font SVG value parsed');

  // return the svg
  var $svg = (0, _cheerio2.default)('<svg>', {
    xmlMode: true
  });
  $svg.attr('xmlns', 'http://www.w3.org/2000/svg');
  $svg.attr('width', width);
  $svg.attr('height', height);
  $svg.attr('viewBox', '0 0 ' + icon.width + ' ' + icon.height);
  $svg = applyAttributes($svg, attrs);
  $svg.append('<path fill="' + color + '" d="' + icon.path + '" />');
  return _cheerio2.default.html($svg);
}

function img(name, color, width, height, attrs) {
  var str = svg(name, color);
  var $img = (0, _cheerio2.default)('<img>');
  $img.attr('width', width);
  $img.attr('height', height);
  $img.attr('src', 'data:image/svg+xml;base64,' + new Buffer(str, 'binary').toString('base64'));
  $img = applyAttributes($img, attrs);
  return _cheerio2.default.html($img);
}

function png(name, color, width, height, attrs, size) {
  var str = svg(name, color);
  width = parseInt(width, 10) || 16;
  height = parseInt(height, 10) || 16;
  size = parseInt(size, 10) || 1;
  if (!_lodash2.default.isNumber(width)) throw new Error('fa.png width must be a number');
  if (!_lodash2.default.isNumber(height)) throw new Error('fa.png height must be a number');
  str = _svg2png2.default.sync(new Buffer(str, 'utf8'), {
    width: parseInt(width * size, 10),
    height: parseInt(height * size, 10)
  });
  var $img = (0, _cheerio2.default)('<img>');
  $img.attr('width', width);
  $img.attr('height', height);
  $img.attr('src', 'data:image/png;base64,' + str.toString('base64'));
  $img = applyAttributes($img, attrs);
  return _cheerio2.default.html($img);
}

function png2x(name, color, width, height, attrs) {
  return png(name, color, width, height, attrs, 2);
}

function png3x(name, color, width, height, attrs) {
  return png(name, color, width, height, attrs, 3);
}

exports.default = {
  aliases: aliases,
  icons: icons,
  iconsByUnicodeHex: iconsByUnicodeHex,
  img: img,
  svg: svg,
  png: png,
  png2x: png2x,
  png3x: png3x
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJzdmciLCJpbWciLCJwbmciLCJwbmcyeCIsInBuZzN4IiwiYXBwbHlBdHRyaWJ1dGVzIiwiJGVsIiwiYXR0cnMiLCJpc0FycmF5IiwibGVuZ3RoIiwiaGFzTWlzc2luZyIsInNvbWUiLCJwYWlyIiwiRXJyb3IiLCJlYWNoIiwiYXR0ciIsImxvYWRBbGlhc2VzIiwibGVzcyIsInBhaXJzIiwiY29tcGFjdCIsIm1hcCIsInNwbGl0IiwibGluZSIsImluZGV4T2YiLCJzdWJzdHJpbmciLCJuYW1lIiwidW5pY29kZSIsInppcE9iamVjdCIsImFsaWFzZXMiLCJyZWFkRmlsZVN5bmMiLCJyZXF1aXJlIiwicmVzb2x2ZSIsImljb25zIiwiaWNvbnNCeVVuaWNvZGVIZXgiLCJjb2xvciIsIndpZHRoIiwiaGVpZ2h0IiwidG9TdHJpbmciLCJpc1N0cmluZyIsInRvTG93ZXJDYXNlIiwiaWNvbiIsImlzT2JqZWN0IiwiJHN2ZyIsInhtbE1vZGUiLCJhcHBlbmQiLCJwYXRoIiwiaHRtbCIsInN0ciIsIiRpbWciLCJCdWZmZXIiLCJzaXplIiwicGFyc2VJbnQiLCJpc051bWJlciIsInN5bmMiXSwibWFwcGluZ3MiOiI7Ozs7OztRQXlFZ0JBLEcsR0FBQUEsRztRQTRDQUMsRyxHQUFBQSxHO1FBVUFDLEcsR0FBQUEsRztRQW1CQUMsSyxHQUFBQSxLO1FBSUFDLEssR0FBQUEsSzs7QUFySmhCOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBLFNBQVNDLGVBQVQsQ0FBeUJDLEdBQXpCLEVBQThCQyxLQUE5QixFQUFxQztBQUNuQztBQUNBLE1BQUksQ0FBQyxpQkFBRUMsT0FBRixDQUFVRCxLQUFWLENBQUQsSUFBcUJBLE1BQU1FLE1BQU4sS0FBaUIsQ0FBMUMsRUFDRSxPQUFPSCxHQUFQO0FBQ0YsTUFBTUksYUFBYSxpQkFBRUMsSUFBRixDQUFPSixLQUFQLEVBQWMsZ0JBQVE7QUFDdkMsV0FBTyxD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LFFBQUosQ0FBYSxRQUFiLENBQTFDO0FBQ0FXLFNBQU8zQyxnQkFBZ0IyQyxJQUFoQixFQUFzQnpDLEtBQXRCLENBQVA7QUFDQSxTQUFPLGtCQUFFdUMsSUFBRixDQUFPRSxJQUFQLENBQVA7QUFDRDs7QUFFTSxTQUFTN0MsS0FBVCxDQUFlc0IsSUFBZixFQUFxQlMsS0FBckIsRUFBNEJDLEtBQTVCLEVBQW1DQyxNQUFuQyxFQUEyQzdCLEtBQTNDLEVBQWtEO0FBQ3ZELFNBQU9MLElBQUl1QixJQUFKLEVBQVVTLEtBQVYsRUFBaUJDLEtBQWpCLEVBQXdCQyxNQUF4QixFQUFnQzdCLEtBQWhDLEVBQXVDLENBQXZDLENBQVA7QUFDRDs7QUFFTSxTQUFTSCxLQUFULENBQWVxQixJQUFmLEVBQXFCUyxLQUFyQixFQUE0QkMsS0FBNUIsRUFBbUNDLE1BQW5DLEVBQTJDN0IsS0FBM0MsRUFBa0Q7QUFDdkQsU0FBT0wsSUFBSXVCLElBQUosRUFBVVMsS0FBVixFQUFpQkMsS0FBakIsRUFBd0JDLE1BQXhCLEVBQWdDN0IsS0FBaEMsRUFBdUMsQ0FBdkMsQ0FBUDtBQUNEOztrQkFFYztBQUNicUIsa0JBRGE7QUFFYkksY0FGYTtBQUdiQyxzQ0FIYTtBQUliaEMsVUFKYTtBQUtiRCxVQUxhO0FBTWJFLFVBTmE7QUFPYkMsY0FQYTtBQVFiQztBQVJhLEMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCAkIGZyb20gJ2NoZWVyaW8nO1xuaW1wb3J0IHN2ZzJwbmcgZnJvbSAnc3ZnMnBuZyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHN2Z2ZvbnQyanMgZnJvbSAnc3ZnZm9udDJqcyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG5mdW5jdGlvbiBhcHBseUF0dHJpYnV0ZXMoJGVsLCBhdHRycykge1xuICAvLyBbIFsgYXR0ciwgdmFsIF0sIC4uLiBdXG4gIGlmICghXy5pc0FycmF5KGF0dHJzKSB8fCBhdHRycy5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuICRlbDtcbiAgY29uc3QgaGFzTWlzc2luZyA9IF8uc29tZShhdHRycywgcGFpciA9PiB7XG4gICAgcmV0dXJuICFfLmlzQXJyYXkocGFpcikgfHwgcGFpci5sZW5ndGggIT09IDI7XG4gIH0pO1xuICBpZiAoaGFzTWlzc2luZykgdGhyb3cgbmV3IEVycm9yKCdhdHRyaWJ1dGUgcGFpcnMgbXVzdCBiZSBhcnJheXMgd2l0aCB0d28ga2V5cyBbIGF0dHIsIHZhbCBdJyk7XG4gIF8uZWFjaChhdHRycywgcGFpciA9PiB7XG4gICAgJGVsLmF0dHIocGFpclswXSwgcGFpclsxXSk7XG4gIH0pO1xuICByZXR1cm4gJGVsO1xufVxuXG4vLyBpbnNwaXJlZCBieSA8aHR0cHM6Ly9naXRodWIuY29tL3Jpb2JhcmQvZm9udC1hd2Vzb21lLXN2Zy9ibG9iL21hc3Rlci9leHRyYWN0LmpzPlxuXG5mdW5jdGlvbiBsb2FkQWxpYXNlcyhsZXNzKSB7XG5cbiAgY29uc3QgcGFpcnMgPSBfLmNvbXBhY3QoXy5tYXAobGVzcy5zcGxpdCgnXFxuJyksIGxpbmUgPT4ge1xuXG4gICAgLy8gbGluZSBpcyBgQGZhLXZhci1kcm9wYm94OiBcIlxcZjE2YlwiO2BcbiAgICBpZiAobGluZS5pbmRleE9mKCdAZmEtdmFyLScpICE9PSAwKSByZXR1cm47XG5cbiAgICAvLyBub3cgaXQgaXMgYGRyb3Bib3g6IFwiXFxmMTZiXCI7YFxuICAgIGxpbmUgPSBsaW5lLnNwbGl0KCdAZmEtdmFyLScsIDIpWzFdO1xuXG4gICAgLy8gc3BsaXQgdGhlIGxpbmUgYnkgdGhlIGA6IGAgZGVsaW1pdGVyXG4gICAgbGluZSA9IGxpbmUuc3BsaXQoJzogJyk7XG5cbiAgICAvLyBub3cgd2UgaGF2ZSBhIGxpbmUgYXJyYXkgdGhhdCBsb29rcyBsaWtlOlxuICAgIC8vIFswXSA9IGBkcm9wYm94YFxuICAgIC8vIFsxXSA9IFwiXFxmMTZiXCI7YFxuXG4gICAgLy8gY2xlYW4gdXAgdGhlIGZpcnN0IGtleVxuICAgIGxpbmVbMV0gPSBsaW5lWzFdLnNwbGl0KCdcIicpWzFdLnN1YnN0cmluZygxKTtcblxuICAgIHJldHVybiB7IG5hbWU6IGxpbmVbMF0sIHVuaWNvZGU6IGxpbmVbMV0gfTtcblxuICB9KSk7XG5cbiAgcmV0dXJuIF8uemlwT2JqZWN0KFxuICAgIF8ubWFwKHBhaXJzLCAnbmFtZScpLFxuICAgIF8ubWFwKHBhaXJzLCAndW5pY29kZScpXG4gICk7XG5cbn1cblxuZXhwb3J0IGNvbnN0IGFsaWFzZXMgPSBsb2FkQWxpYXNlcyhcbiAgZnMucmVhZEZpbGVTeW5jKFxuICAgIHJlcXVpcmUucmVzb2x2ZSgnZm9udC1hd2Vzb21lL2xlc3MvdmFyaWFibGVzLmxlc3MnKSxcbiAgICAndXRmOCdcbiAgKVxuKTtcblxuZXhwb3J0IGNvbnN0IGljb25zID0gc3ZnZm9udDJqcyhcbiAgZnMucmVhZEZpbGVTeW5jKFxuICAgIHJlcXVpcmUucmVzb2x2ZSgnZm9udC1hd2Vzb21lL2ZvbnRzL2ZvbnRhd2Vzb21lLXdlYmZvbnQuc3ZnJyksXG4gICAgJ3V0ZjgnXG4gIClcbik7XG5cbmV4cG9ydCBjb25zdCBpY29uc0J5VW5pY29kZUhleCA9IF8uemlwT2JqZWN0KFxuICBfLm1hcChpY29ucywgJ3VuaWNvZGVfaGV4JyksXG4gIGljb25zXG4pO1xuXG5leHBvcnQgZnVuY3Rpb24gc3ZnKG5hbWUsIGNvbG9yLCB3aWR0aCwgaGVpZ2h0LCBhdHRycykge1xuXG4gIC8vIHNldCBkZWZhdWx0c1xuICBuYW1lID0gbmFtZSB8fCAnc21pbGUtbyc7XG4gIGNvbG9yID0gY29sb3IgfHwgJyMwMDAnO1xuICB3aWR0aCA9ICh3aWR0aCB8fCAnMTAwJScpLnRvU3RyaW5nKCk7XG4gIGhlaWdodCA9IChoZWlnaHQgfHwgJzEwMCUnKS50b1N0cmluZygpO1xuXG4gIC8vIGNoZWNrIHZhcmlhYmxlIHR5cGVzXG4gIGlmICghXy5pc1N0cmluZyhuYW1lKSkgdGhyb3cgbmV3IEVycm9yKCdmYS5zdmcgYG5hbWVgIG11c3QgYmUgYSBTdHJpbmcnKTtcbiAgaWYgKCFfLmlzU3RyaW5nKGNvbG9yKSkgdGhyb3cgbmV3IEVycm9yKCdmYS5zdmcgYGNvbG9yYCBtdXN0IGJlIGEgU3RyaW5nJyk7XG5cbiAgLy8gY29udmVydCBuYW1lIHRvIGxvd2VyY2FzZVxuICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gIC8vIHJlbW92ZSBcImZhLVwiIHByZWZpeCBmcm9tIG5hbWUgaWYgaXQgZXhpc3RzXG4gIGlmIChuYW1lLmluZGV4T2YoJ2ZhLScpID09PSAwKVxuICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygzKTtcblxuICAvLyBlbnN1cmUgdGhhdCB0aGUgZm9udCBleGlzdHMsIG90aGVyd2lzZSB0aHJvdyBhbiBlcnJvclxuICBpZiAoIV8uaXNTdHJpbmcoYWxpYXNlc1tuYW1lXSkpXG4gICAgdGhyb3cgbmV3IEVycm9yKGBmYS5zdmcgbmFtZSBcIiR7bmFtZX1cIiBtdXN0IGJlIGEgdmFsaWQgRm9udEF3ZXNvbWUgaWNvbiBuYW1lYCk7XG5cbiAgLy8gZ2V0IHRoZSBpY29uIHN2ZyBpbmZvcm1hdGlvblxuICBjb25zdCBpY29uID0gaWNvbnNCeVVuaWNvZGVIZXhbYWxpYXNlc1tuYW1lXV07XG5cbiAgLy8gZW5zdXJlIHRoYXQgdGhlIGZvbnQgc3ZnIGV4aXN0cywgb3RoZXJ3aXNlIHRocm93IGFuIGVycm9yXG4gIGlmICghXy5pc09iamVjdChpY29uKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGZhLnN2ZyBuYW1lIFwiJHtuYW1lfVwiIHdhcyBtaXNzaW5nIGl0cyBmb250IFNWRyB2YWx1ZSBwYXJzZWRgKTtcblxuICAvLyByZXR1cm4gdGhlIHN2Z1xuICBsZXQgJHN2ZyA9ICQoJzxzdmc+Jywge1xuICAgIHhtbE1vZGU6IHRydWVcbiAgfSk7XG4gICRzdmcuYXR0cigneG1sbnMnLCAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnKTtcbiAgJHN2Zy5hdHRyKCd3aWR0aCcsIHdpZHRoKTtcbiAgJHN2Zy5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAkc3ZnLmF0dHIoJ3ZpZXdCb3gnLCBgMCAwICR7aWNvbi53aWR0aH0gJHtpY29uLmhlaWdodH1gKTtcbiAgJHN2ZyA9IGFwcGx5QXR0cmlidXRlcygkc3ZnLCBhdHRycyk7XG4gICRzdmcuYXBwZW5kKGA8cGF0aCBmaWxsPVwiJHtjb2xvcn1cIiBkPVwiJHtpY29uLnBhdGh9XCIgLz5gKTtcbiAgcmV0dXJuICQuaHRtbCgkc3ZnKTtcblxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW1nKG5hbWUsIGNvbG9yLCB3aWR0aCwgaGVpZ2h0LCBhdHRycykge1xuICBjb25zdCBzdHIgPSBzdmcobmFtZSwgY29sb3IpO1xuICBsZXQgJGltZyA9ICQoJzxpbWc+Jyk7XG4gICRpbWcuYXR0cignd2lkdGgnLCB3aWR0aCk7XG4gICRpbWcuYXR0cignaGVpZ2h0JywgaGVpZ2h0KTtcbiAgJGltZy5hdHRyKCdzcmMnLCBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke25ldyBCdWZmZXIoc3RyLCAnYmluYXJ5JykudG9TdHJpbmcoJ2Jhc2U2NCcpfWApO1xuICAkaW1nID0gYXBwbHlBdHRyaWJ1dGVzKCRpbWcsIGF0dHJzKTtcbiAgcmV0dXJuICQuaHRtbCgkaW1nKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBuZyhuYW1lLCBjb2xvciwgd2lkdGgsIGhlaWdodCwgYXR0cnMsIHNpemUpIHtcbiAgbGV0IHN0ciA9IHN2ZyhuYW1lLCBjb2xvcik7XG4gIHdpZHRoID0gcGFyc2VJbnQod2lkdGgsIDEwKSB8fCAxNjtcbiAgaGVpZ2h0ID0gcGFyc2VJbnQoaGVpZ2h0LCAxMCkgfHwgMTY7XG4gIHNpemUgPSBwYXJzZUludChzaXplLCAxMCkgfHwgMTtcbiAgaWYgKCFfLmlzTnVtYmVyKHdpZHRoKSkgdGhyb3cgbmV3IEVycm9yKCdmYS5wbmcgd2lkdGggbXVzdCBiZSBhIG51bWJlcicpO1xuICBpZiAoIV8uaXNOdW1iZXIoaGVpZ2h0KSkgdGhyb3cgbmV3IEVycm9yKCdmYS5wbmcgaGVpZ2h0IG11c3QgYmUgYSBudW1iZXInKTtcbiAgc3RyID0gc3ZnMnBuZy5zeW5jKG5ldyBCdWZmZXIoc3RyLCAndXRmOCcpLCB7XG4gICAgd2lkdGg6IHBhcnNlSW50KHdpZHRoICogc2l6ZSwgMTApLFxuICAgIGhlaWdodDogcGFyc2VJbnQoaGVpZ2h0ICogc2l6ZSwgMTApXG4gIH0pO1xuICBsZXQgJGltZyA9ICQoJzxpbWc+Jyk7XG4gICRpbWcuYXR0cignd2lkdGgnLCB3aWR0aCk7XG4gICRpbWcuYXR0cignaGVpZ2h0JywgaGVpZ2h0KTtcbiAgJGltZy5hdHRyKCdzcmMnLCBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7c3RyLnRvU3RyaW5nKCdiYXNlNjQnKX1gKTtcbiAgJGltZyA9IGFwcGx5QXR0cmlidXRlcygkaW1nLCBhdHRycyk7XG4gIHJldHVybiAkLmh0bWwoJGltZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwbmcyeChuYW1lLCBjb2xvciwgd2lkdGgsIGhlaWdodCwgYXR0cnMpIHtcbiAgcmV0dXJuIHBuZyhuYW1lLCBjb2xvciwgd2lkdGgsIGhlaWdodCwgYXR0cnMsIDIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcG5nM3gobmFtZSwgY29sb3IsIHdpZHRoLCBoZWlnaHQsIGF0dHJzKSB7XG4gIHJldHVybiBwbmcobmFtZSwgY29sb3IsIHdpZHRoLCBoZWlnaHQsIGF0dHJzLCAzKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBhbGlhc2VzLFxuICBpY29ucyxcbiAgaWNvbnNCeVVuaWNvZGVIZXgsXG4gIGltZyxcbiAgc3ZnLFxuICBwbmcsXG4gIHBuZzJ4LFxuICBwbmczeFxufTtcbiJdfQ==